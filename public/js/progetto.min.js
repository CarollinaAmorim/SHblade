$(document).ready(function () {

    var pulsanteMenu = $("div#espandi_menu"),
        imgPulanteMenu = $("div#espandi_menu > img"),
        linkMenu = $("nav[role=menu] ul a");

    function oscuraPagina() { $("<div id='oscura'></div>").appendTo("body").hide().fadeIn(1000); }
    function eliminaOscuraPagina() { $("div#oscura").remove(); }

    imgPulanteMenu.eq(1).hide();
    $("nav[role=menu] *").hide();

    function animateML(){
        var larghezzaSchermo = $(window).width();
        if(larghezzaSchermo >= 1360){
            pulsanteMenu.hide().animate({left: "30%", marginLeft: "-50px"}, 750);
            $("nav[role=menu]").animate({width: "30%"}, 750);
        }
        else if(larghezzaSchermo <= 1270){
            pulsanteMenu.hide().animate({left: "90%", marginLeft: "-20px"}, 750);
            $("nav[role=menu]").animate({width: "90%"}, 750);
        }
        else{
            pulsanteMenu.hide().animate({left: "30%", marginLeft: "-25px"}, 750);
            $("nav[role=menu]").animate({width: "30%"}, 750);
        }
    }

    imgPulanteMenu.eq(0).click(function () {
        linkMenu.css("width", "0%");
        animateML();
        imgPulanteMenu.eq(0).hide();
        imgPulanteMenu.eq(1).show();
        pulsanteMenu.delay(800).fadeIn(1000);
        oscuraPagina();

        $("nav[role=menu] > img").delay(750).fadeIn();
        $("nav[role=menu] > ul, nav[role=menu] ul *").delay(1000).fadeIn();
        linkMenu.eq(0).delay(50).animate({width: "100%"});
        linkMenu.eq(1).delay(100).animate({width: "100%"});
        linkMenu.eq(2).delay(150).animate({width: "100%"});
        linkMenu.eq(3).delay(200).animate({width: "100%"});
        linkMenu.eq(4).delay(250).animate({width: "100%"});
        linkMenu.eq(5).delay(300).animate({width: "100%"});
    });

    function initML(){
        var larghezzaSchermo = $(window).width();
        if(larghezzaSchermo >= 1360){
            pulsanteMenu.hide().animate({left: "0%", marginLeft: "50px"}, 750);
        }
        else if(larghezzaSchermo <= 1270){
            pulsanteMenu.hide().animate({left: "0%", marginLeft: "0px"}, 750);
        }
        else{
            pulsanteMenu.hide().animate({left: "0%", marginLeft: "25px"}, 750);
        }
    }

    function InitStatus(){
        $("nav[role=menu] *").fadeOut(100);
        initML();
        $("nav[role=menu]").animate({width: "0%"}, 750);
        imgPulanteMenu.eq(1).hide();
        imgPulanteMenu.eq(0).show();
        pulsanteMenu.fadeIn(1000);
        eliminaOscuraPagina();
    }

    imgPulanteMenu.eq(1).click(function () {
        InitStatus();
    });

    $('#oscura').click(function(){
        InitStatus();
    });

    var CorniceDestra    = $('#barra_destra'),
        UL               = CorniceDestra.find('ul'),
        LIslide          = UL.find('.cerchio'),
        Slide            = $('article.vs-section'),
        dimLI            = 10,// altezza li
        marginBottomLI   = 20,// margin bottom li
        nLI              = Slide.length,
        heightUL         = ((dimLI + marginBottomLI) * nLI)+20+60,
        heightContainer  = 260, // altezza del contenitore ul
        close            = 0,
        marginTopULopen  = (heightContainer - heightUL)/2,
        marginTopULclose = 90,
        Tempo            = 500;// altezza container - 20px li marginTop - 60 altezza prev e next, diviso 2

    CorniceDestra.hover(function(){
        UL.animate({'margin-top':marginTopULopen + 'px'},Tempo);
        LIslide.animate({'height':dimLI + 'px','margin-bottom':marginBottomLI + 'px'},Tempo);
    }, function(){
        UL.animate({'margin-top':marginTopULclose+'px'},Tempo);
        LIslide.animate({'height':close+'px','margin-bottom':close+'px'},Tempo);
    });
});
var verticalSlider = {

    // Variables defined by the user
    scrollThreshold: 1,
    sectionsContainer: null,
    sections: null,

    // Other variables
    delta: 0,
    animating: false,
    currentSection: null,
    animationsSettings: {
        visible: 'translateNone',
        top:     'translateUp.half',
        bottom:  'translateDown',
        easing:  'easeInCubic',
        duration: 800
    },

    init: function() {

        var _this = this;

        // Initialise variables
        this.sectionsContainer = $('.vs-slider');
        this.sections          = $('.vs-section');
        this.cerchio           = $('.cerchio');// rispettivo per slide controller
        this.currentSection    = this.sections.filter('.active');
        this.currentCerchio    = this.cerchio.filter('.active');// rispettivo per slide controller

        // Change vh to px value on mobile
        if( Modernizr.mq('only screen and (max-width: 1200px)') ) {
            _this.sectionsContainer.height( $( window ).height() );
        }

        // Add a 100ms time out to avoid an issue where the first section swipe effect is lagging
        setTimeout(function() {

            // Current section
            _this.currentSection.velocity( _this.animationsSettings.visible, 0 );
            _this.currentCerchio.css('opacity',1);// rispettivo per slide controller

            // Bottom section
            if( _this.currentSection.prevAll('.vs-section').index() > -1 ) {
                _this.currentSection.prevAll('.vs-section').css('opacity', 1).velocity( _this.animationsSettings.top, 0 );
                _this.currentCerchio.css('opacity',1);// rispettivo per slide controller
            }

            // Top section
            if( _this.currentSection.nextAll('.vs-section').index() > -1 ) {
                _this.currentSection.nextAll('.vs-section').css('opacity', 1).velocity( _this.animationsSettings.bottom, 0 );
                _this.currentCerchio.css('opacity',1);// rispettivo per slide controller
            }

            // Bind events
            _this.bindEvents();

        }, 100);

    },


    prev: function() {
        // All tests will be done in the moveTo function
        this.moveTo( this.currentSection.index() - 1 );
    },

    next: function() {
        // All tests will be done in the moveTo function
        this.moveTo( this.currentSection.index() + 1 );
    },

    moveTo: function( sectionIndex ) {

        var _this = this;
        var nextSection;
        var nextCerchio;// rispettivo per slide controller
        var animation;

        // Test the slider is not already moving and the requested section is not the current one
        if( !this.animating && this.currentSection.index() !== sectionIndex ) {

            // Animations starting
            _this.animating = true;

            // Test if the requested section is not before the first or after the last one
            if( sectionIndex > -1 && sectionIndex < _this.sections.length ) {

                if( sectionIndex > _this.currentSection.index() ) { // Requested section is after the current one
                    nextSection = _this.currentSection.next('.vs-section');
                    nextCerchio = _this.currentCerchio.next('.cerchio');// rispettivo per slide controller
                    animation   = _this.animationsSettings.top;
                } else { // Requested section is before the current one
                    nextSection = _this.currentSection.prev('.vs-section');
                    nextCerchio = _this.currentCerchio.prev('.cerchio');// rispettivo per slide controller
                    animation   = _this.animationsSettings.bottom;
                }

                // Actual animation
                _this.currentSection.removeClass('active').velocity( animation, _this.animationsSettings.easing, _this.animationsSettings.duration).find('header').fadeOut(); // .find('header').fadeOut() solo per nascondere contenuto figlio
                _this.currentCerchio.removeClass('active').css('opacity',0.3);// rispettivo per slide controller
                nextSection.addClass('active').velocity(_this.animationsSettings.visible, _this.animationsSettings.easing, _this.animationsSettings.duration, function() {
                    $('.active > header').delay(500).fadeIn();//solo per mostrare contenuto figlio
                    nextCerchio.addClass('active').css('opacity',1);// rispettivo per slide controller


                    // Animations stopped
                    _this.animating      = false;
                    // Update current section variable
                    _this.currentSection = nextSection;
                    _this.currentCerchio = nextCerchio;// rispettivo per slide controller
                });

            } else {

                // At this stage the requested section is either after the last one or before the first one

                if( sectionIndex <= -1 ) { // Requested section is before the first one
                    _this.currentSection.velocity( 'bounceDown', _this.animationsSettings.easing, 400, function() {
                        _this.animating = false;
                    });
                } else if( sectionIndex >= _this.sections.length ) { // Requested section is after the last one
                    _this.currentSection.velocity( 'bounceUp', _this.animationsSettings.easing, 400, function() {
                        _this.animating = false;
                    });
                }

            }

        } else {
            // Requested section is the current one
            return false;
        }

    },

    bindEvents: function() {

        var _this = this;

        if( Modernizr.mq('only screen and (max-width: 1200px)') ) {
            // Resize sections on window resize, on mobile
            $( window ).on('resize', function() {
                _this.sectionsContainer.height( $( window ).height() );
            });
        }

        // Scroll with mousewheel actions
        $( window ).on('DOMMouseScroll mousewheel', function( event ) {

            // Check the scroll direction
            if ( event.originalEvent.detail < 0 || event.originalEvent.wheelDelta > 0 ) {

                _this.delta--;

                if( Math.abs( _this.delta ) >= _this.scrollThreshold ) {
                    _this.prev();
                } else {
                    return false;
                }

            } else {

                _this.delta++;

                if( _this.delta >= _this.scrollThreshold ) {
                    _this.next();
                } else {
                    return false;
                }

            }

            // Reset delta
            delta = 0;

            return false;

        });

        // Keyboard arrows actions
        $( document ).on('keyup', function( event ) {

            if( event.which == '40' ) {
                _this.next();
            } else if( event.which == '38' ) {
                _this.prev();
            }

        });

        // Events for devices which support touch events
        if( Modernizr.touch ) {

            // Hammer.js

            // Swipe gesture
            var hammerVS = new Hammer( _this.sectionsContainer[0] );

            hammerVS.get('swipe').set({ direction: Hammer.DIRECTION_VERTICAL });

            hammerVS.on('swipeup', function() {   _this.next(); });
            hammerVS.on('swipedown', function() { _this.prev(); });

            // Navigation arrows
            var hammerVSprev = new Hammer( $('.vs-prev')[0] );
            var hammerVSnext = new Hammer( $('.vs-next')[0] );

            hammerVSprev.on('tap', function() { _this.prev(); });
            hammerVSnext.on('tap', function() { _this.next(); });

        } else {

            $('.vs-prev').on('click', function() { _this.prev(); });
            $('.vs-next').on('click', function() { _this.next(); });

        }

    }

};

// Register Velocity effects
$.Velocity.RegisterEffect('translateNone', {
    defaultDuration: 1,
    calls: [
        [ { translateZ: 0, translateY: '0%', opacity: 1 }, 1 ]
    ]
});

$.Velocity.RegisterEffect('translateDown', {
    defaultDuration: 1,
    calls: [
        [ { translateZ: 0, translateY: '100%' }, 1 ]
    ]
});

$.Velocity.RegisterEffect('translateUp.half', {
    defaultDuration: 1,
    calls: [
        [ { translateZ: 0, translateY: '-50%' }, 1 ]
    ]
});

$.Velocity.RegisterEffect('bounceDown', {
    defaultDuration: 1,
    calls: [
        [ { translateZ: 0, translateY: '10%' }, 1 ],
        [ { translateZ: 0, translateY: '0%' }, 1 ]
    ]
});

$.Velocity.RegisterEffect('bounceUp', {
    defaultDuration: 1,
    calls: [
        [ { translateZ: 0, translateY: '-10%' }, 1 ],
        [ { translateZ: 0, translateY: '0%' }, 1 ]
    ]
});
$(document).ready(function() {

    // Initialise the vertical slider
    verticalSlider.init();

    var CContenitore = $('#contenuto'),
        CAll         = $('.contenuti_descrizione,.contenuti_concept,.contenuti_dettagli1,.contenuti_dettagli2'),
        CLarghezza   = 85,
        ApriChiudi   = $('#apri_chiudi'),
        Pschede      = $('.cambia_scheda'),
        Pdescrizione = $('#descrizione'),
        Pconcept     = $('#concept'),
        Pdettagli1   = $('#dettagli1'),
        Pdettagli2   = $('#dettagli2'),
        Cdescrizione = $('.contenuti_descrizione'),
        Cconcept     = $('.contenuti_concept'),
        Cdettagli1   = $('.contenuti_dettagli1'),
        Cdettagli2   = $('.contenuti_dettagli2'),
        TAnimazione  = 1000,
        Tpausa       = 500;

    Cconcept.hide();Cdettagli1.hide();Cdettagli2.hide();
    ApriChiudi.addClass('fa-times');

    function espandiSchede(){
        CContenitore.animate({'width':CLarghezza+'%'},TAnimazione).addClass('visible');
        ApriChiudi.addClass('fa-times').removeClass('fa-chevron-right');
    }

    Pdescrizione.addClass('selezionato');

    Pschede.click(function(){
        if (!CContenitore.hasClass('visible')) {
            espandiSchede();
        }
        CAll.fadeOut(Tpausa);
    });

    Pdescrizione.click(function(){
        Cdescrizione.delay(Tpausa).fadeIn(TAnimazione);
        Pschede.removeClass('selezionato');
        $(this).addClass('selezionato');
    });
    Pconcept.click(function(){
        Cconcept.delay(Tpausa).fadeIn(TAnimazione);
        Pschede.removeClass('selezionato');
        $(this).addClass('selezionato');
    });
    Pdettagli1.click(function(){
        Cdettagli1.delay(Tpausa).fadeIn(TAnimazione);
        Pschede.removeClass('selezionato');
        $(this).addClass('selezionato');
    });
    Pdettagli2.click(function(){
        Cdettagli2.delay(Tpausa).fadeIn(TAnimazione);
        Pschede.removeClass('selezionato');
        $(this).addClass('selezionato');
    });

    ApriChiudi.click(function(){
        if (CContenitore.hasClass('visible')) {
            CAll.fadeOut(Tpausa);
            CContenitore.delay(Tpausa).animate({'width':'50px'},TAnimazione).removeClass('visible');
            ApriChiudi.addClass('fa-chevron-right').removeClass('fa-times');
        } else{
            espandiSchede();
            Cdescrizione.delay(TAnimazione).fadeIn(Tpausa);
        }
    });


});